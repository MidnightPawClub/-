<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å’¸é±¼ä¿®è¡Œ Â· ä»Šæ—¥é¢æ¿</title>
<style>
  :root{
    --bg:#0f1216; --card:#151a21; --ink:#e8eef7; --muted:#a8b3c7; --accent:#86e1d8; --line:#233040;
    --ok:#9ee493; --warn:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:880px;margin:32px auto;padding:0 16px}
  header{display:flex;gap:12px;align-items:center;margin-bottom:16px}
  header h1{font-size:22px;margin:0}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;margin:12px 0}
  .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .row label{white-space:nowrap}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--line);border-radius:10px}
  input[type="date"], input[type="text"], textarea{
    background:#0d1117;border:1px solid var(--line);border-radius:10px;color:var(--ink);padding:8px 10px;width:100%;
  }
  textarea{min-height:72px;resize:vertical}
  .checks{display:flex;flex-wrap:wrap;gap:8px}
  .checks label{padding:8px 10px;border:1px solid var(--line);border-radius:10px;cursor:pointer}
  .checks input{margin-right:6px}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  button{
    background:#1b2532;border:1px solid var(--line);color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer;
  }
  button.primary{background:var(--accent);color:#0b1117;border-color:transparent;font-weight:600}
  button.ghost{background:transparent}
  button.warn{background:#30220f;border-color:#4a3412}
  .muted{color:var(--muted)}
  details{background:#0d1117;border:1px solid var(--line);border-radius:10px;padding:10px;margin:8px 0}
  details summary{cursor:pointer}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);margin-left:6px;color:var(--muted)}
  .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#1e2a38;border:1px solid var(--line);color:var(--ink);
    padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s}
  .toast.show{opacity:1}
  .divider{height:1px;background:var(--line);margin:12px 0}
  .footer{color:var(--muted);font-size:13px;margin:20px 0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ğŸŸ å’¸é±¼ä¿®è¡Œ Â· ä»Šæ—¥é¢æ¿</h1>
    <span class="pill" id="version">v0.1</span>
  </header>

  <!-- æ—¥æœŸ + çŠ¶æ€ -->
  <section class="card" aria-labelledby="sec-date">
    <h2 id="sec-date" style="margin:0 0 8px 0;font-size:18px;">ğŸ“† æ—¥æœŸ & ğŸ§˜â€â™€ï¸ ä»Šæ—¥çŠ¶æ€</h2>
    <div class="row" style="gap:16px">
      <label for="date">æ—¥æœŸï¼š</label>
      <input id="date" type="date" />
    </div>
    <div class="row" style="gap:12px;margin-top:8px">
      <label class="chip"><input type="radio" name="status" value="ç»ˆæ—¥æ— äº‹">ç»ˆæ—¥æ— äº‹</label>
      <label class="chip"><input type="radio" name="status" value="æ­£å¸¸è¥ä¸š">æ­£å¸¸è¥ä¸š</label>
      <label class="chip"><input type="radio" name="status" value="ç´¯ç˜«äº†">ç´¯ç˜«äº†</label>
      <label class="chip"><input type="radio" name="status" value="è‡ªç”±å¡«">è‡ªç”±å¡«</label>
      <input id="statusCustom" type="text" placeholder="è‡ªå®šä¹‰çŠ¶æ€ï¼ˆé€‰â€œè‡ªç”±å¡«â€åç”Ÿæ•ˆï¼‰" />
    </div>
    <p class="muted" style="margin-top:6px">åŒä¸€å¤©åªä¿ç•™ä¸€æ¡è®°å½•ï¼›å†æ¬¡ä¿å­˜ä¼šè¦†ç›–è¯¥æ—¥ã€‚</p>
  </section>

  <!-- ä»Šæ—¥è¿›åº¦ -->
  <section class="card" aria-labelledby="sec-progress">
    <h2 id="sec-progress" style="margin:0 0 8px 0;font-size:18px;">ğŸ“ ä»Šæ—¥è¿›åº¦</h2>
    <div class="checks" id="progressChecks">
      <label><input type="checkbox" value="æ•°å­¦">æ•°å­¦</label>
      <label><input type="checkbox" value="ç¼–ç¨‹">ç¼–ç¨‹</label>
      <label><input type="checkbox" value="å†™ä½œ">å†™ä½œ</label>
      <label><input type="checkbox" value="è¿åŠ¨">è¿åŠ¨</label>
      <label><input type="checkbox" value="ç¤¾äº¤">ç¤¾äº¤</label>
    </div>
  </section>

  <!-- è‡ªå®šä¹‰è¾“å…¥ -->
  <section class="card" aria-labelledby="sec-free">
    <h2 id="sec-free" style="margin:0 0 8px 0;font-size:18px;">ğŸµ æˆå°±è§£é” & ğŸ éšè—æ”¶è·</h2>
    <input id="achieve" type="text" placeholder="ä¾‹ï¼šçœ‹äº†ä¸€èŠ‚å´æ©è¾¾ / åƒäº†ä¸€æ ¹å†°æ£" />
    <div style="height:8px"></div>
    <textarea id="secret" placeholder="ä»Šå¤©æ‚„æ‚„å®Œæˆäº†ä»€ä¹ˆå¿ƒäº‹ï¼Ÿï¼ˆä»…è‡ªå·±å¯è§ï¼Œå­˜æœ¬åœ°ï¼‰"></textarea>
  </section>

  <!-- ç»“è¯­ -->
  <section class="card" aria-labelledby="sec-outro">
    <h2 id="sec-outro" style="margin:0 0 8px 0;font-size:18px;">ğŸŸ ç»“è¯­</h2>
    <input id="outro" type="text" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆä¸€æ¡çŒ«çŒ«é£æ ¼ç»“è¯­" />
    <div class="btns">
      <button class="ghost" id="btnAutoOutro">ğŸ² éšæœºä¸€å¥</button>
    </div>
  </section>

  <!-- æ“ä½œæŒ‰é’® -->
  <section class="card" aria-labelledby="sec-actions">
    <h2 id="sec-actions" style="margin:0 0 8px 0;font-size:18px;">âš™ï¸ æ“ä½œ</h2>
    <div class="btns">
      <button class="primary" id="btnSave">ğŸ“Œ ä¿å­˜è®°å½•</button>
      <button id="btnLoad">ğŸ” è½½å…¥å½“æ—¥ï¼ˆè‹¥å·²æœ‰ï¼‰</button>
      <button id="btnIdle">ğŸ”˜ æˆ‘é€‰æ‹©ç»ˆæ—¥æ— äº‹ï¼</button>
      <button id="btnHistory">ğŸ•°ï¸ æŸ¥çœ‹å†å²</button>
      <button id="btnExportJson">ğŸ“¤ å¯¼å‡º JSON</button>
      <button id="btnExportTxt">ğŸ“¤ å¯¼å‡º TXT</button>
      <button class="warn" id="btnClearAll">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
    </div>
    <div class="divider"></div>
    <p class="muted">æ•°æ®ä»…ä¿å­˜åœ¨æœ¬æœºæµè§ˆå™¨çš„ <code>localStorage</code> ä¸­ï¼›æ¢è®¾å¤‡æˆ–æ¸…æµè§ˆæ•°æ®ä¼šä¸¢å¤±ã€‚</p>
  </section>

  <!-- å†å²åŒº -->
  <section class="card" id="historySection" style="display:none" aria-labelledby="sec-history">
    <h2 id="sec-history" style="margin:0 0 8px 0;font-size:18px;">ğŸ“š å†å²è®°å½•</h2>
    <div id="historyList"></div>
  </section>

  <div class="footer">å°æç¤ºï¼šæ—¥æœŸå·¦ä¾§æœ‰ã€Œè½½å…¥å½“æ—¥ã€æŒ‰é’®ï¼Œå¯æŠŠå½“æ—¥å·²å­˜è®°å½•æ‹‰å›è¡¨å•ç¼–è¾‘ã€‚</div>
</div>

<div class="toast" id="toast"></div>

<script>
  // ---- å°å·¥å…· ----
  const STORAGE_KEY = 'fishlog.v1';
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  function todayStr(){
    // æœ¬åœ°æ—¶åŒºå®‰å…¨çš„ YYYY-MM-DD
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function toast(msg,ms=1600){
    const t = $('#toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), ms);
  }
  function getStore(){
    try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }
    catch{ return {}; }
  }
  function setStore(obj){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  }
  function download(filename, content, type='application/json'){
    const blob = new Blob([content], {type});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename; document.body.appendChild(a);
    a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // ---- ç»“è¯­åº“ & ç”Ÿæˆå™¨ ----
  const QUOTES = [
    "ä»Šå¤©ä¹Ÿåœ¨çŒ«çŒ«çš„æ€€é‡Œèººè¿‡ä¸€å¤©ï½",
    "é£æŠŠæ—¥å­å¹å¾—ä¸ç´§ä¸æ…¢ï¼Œæˆ‘å°±æ…¢æ…¢èµ°ã€‚",
    "å­¦ä¹ æ˜¯æ­£ç»äº‹ï¼Œå’¸é±¼ä¹Ÿæ˜¯æ­£ç»èººã€‚",
    "å°æ­¥ä¸å«Œæ…¢ï¼Œåœä¸‹ä¹Ÿç®—åœ¨è·¯ä¸Šã€‚",
    "ç»™è„‘è¢‹ä¸€å—è‰åœ°ï¼Œç»™å¿ƒä¸€å£°å‘µæ¬ ã€‚"
  ];
  function autoOutro(rec){
    // æ ¹æ®çŠ¶æ€/è¿›åº¦ç»™ä¸€å¥é»˜è®¤ç»“è¯­
    const checked = (rec.progress||[]).length;
    const s = rec.status || 'æ­£å¸¸è¥ä¸š';
    if(!checked && s.includes('æ— äº‹')) return "ä»Šå¤©æˆ‘å…è®¸è‡ªå·±æ— äº‹ï¼ŒçŒ«çŒ«ä¼¸ä¸ªæ‡’è…°ï½";
    if(checked >= 4) return "å¹²å¾—æ¼‚äº®ï¼ŒçŒ«çŒ«ä»Šå¤©æ˜¯æ•ˆç‡çŒ›å…½ï¼ˆæ¸©æŸ”æ¬¾ï¼‰ã€‚";
    if(checked >= 2) return "èŠ‚å¥å¯¹äº†å°±å¥½ï¼Œæ…¢æ…¢è·‘ä¸æ‰ã€‚";
    if(s.includes('ç´¯')) return "ç´¯å°±æ­‡æ­‡ï¼Œæ­‡æ˜¯ä¸ºäº†ä¸‹ä¸€æ¬¡æ›´é¡ºæ‰‹ã€‚";
    return QUOTES[Math.floor(Math.random()*QUOTES.length)];
  }

  // ---- è¯»/å†™è¡¨å• ----
  function readForm(){
    const date = $('#date').value || todayStr();
    const statusRadio = document.querySelector('input[name="status"]:checked');
    let status = statusRadio ? statusRadio.value : '';
    if(status === 'è‡ªç”±å¡«'){
      const custom = $('#statusCustom').value.trim();
      if(custom) status = custom;
    }
    const progress = $$('#progressChecks input:checked').map(i=>i.value);
    const achieve = $('#achieve').value.trim();
    const secret = $('#secret').value.trim();
    let outro = $('#outro').value.trim();

    const rec = { date, status, progress, achieve, secret, outro };
    if(!outro) rec.outro = autoOutro(rec);
    return rec;
  }
  function writeForm(rec){
    $('#date').value = rec.date || todayStr();
    // çŠ¶æ€
    let matched = false;
    $$('#statusCustom').forEach(()=>{}); // no-op for consistency
    $$('input[name="status"]').forEach(r=>{
      r.checked = false;
      if(rec.status && r.value === rec.status){ r.checked = true; matched = true; }
    });
    if(!matched && rec.status){
      // æ”¾åˆ°è‡ªç”±å¡«
      $$('input[name="status"]').forEach(r=>{ if(r.value==='è‡ªç”±å¡«') r.checked = true; });
      $('#statusCustom').value = rec.status;
    }
    // è¿›åº¦
    $$(`#progressChecks input`).forEach(i=>i.checked = (rec.progress||[]).includes(i.value));
    $('#achieve').value = rec.achieve || '';
    $('#secret').value = rec.secret || '';
    $('#outro').value = rec.outro || '';
  }

  // ---- ä¿å­˜/è½½å…¥/å†å² ----
  function saveRecord(rec){
    const store = getStore();
    store[rec.date] = rec;
    setStore(store);
  }
  function loadRecordByDate(date){
    const rec = getStore()[date];
    if(rec){ writeForm(rec); toast(`å·²è½½å…¥ ${date} çš„è®°å½•`); }
    else{ toast(`æ²¡æœ‰æ‰¾åˆ° ${date} çš„è®°å½•`); }
  }
  function renderHistory(){
    const list = $('#historyList');
    list.innerHTML = '';
    const store = getStore();
    const dates = Object.keys(store).sort((a,b)=>a<b?1:-1); // desc
    if(!dates.length){
      list.innerHTML = `<p class="muted">æš‚æ— è®°å½•ã€‚</p>`;
      return;
    }
    dates.forEach(d=>{
      const r = store[d];
      const el = document.createElement('details');
      el.innerHTML = `
        <summary><strong>${d}</strong>
          <span class="pill">${(r.status||'')}</span>
          ${r.progress?.length ? `<span class="pill">${r.progress.join(' / ')}</span>` : ''}
        </summary>
        <div style="padding:8px 2px 0 2px">
          ${r.achieve?`<div>ğŸµ æˆå°±ï¼š${escapeHTML(r.achieve)}</div>`:''}
          ${r.secret?`<div>ğŸ éšè—ï¼š${escapeHTML(r.secret)}</div>`:''}
          ${r.outro?`<div>ğŸŸ ç»“è¯­ï¼š${escapeHTML(r.outro)}</div>`:''}
          <div class="btns" style="margin-top:8px">
            <button data-act="load" data-date="${d}">â†©ï¸ è½½å…¥åˆ°è¡¨å•</button>
            <button data-act="delete" data-date="${d}" class="warn">ğŸ—‘ï¸ åˆ é™¤è¯¥æ—¥</button>
          </div>
        </div>
      `;
      list.appendChild(el);
    });
    // ä»£ç†æŒ‰é’®äº‹ä»¶
    list.onclick = (e)=>{
      const b = e.target.closest('button'); if(!b) return;
      const date = b.getAttribute('data-date');
      const act = b.getAttribute('data-act');
      if(act==='load'){ loadRecordByDate(date); }
      if(act==='delete'){
        const ok = confirm(`ç¡®å®šåˆ é™¤ ${date} è¿™å¤©çš„è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`);
        if(ok){
          const store = getStore(); delete store[date]; setStore(store);
          renderHistory(); toast('å·²åˆ é™¤');
        }
      }
    };
  }
  function escapeHTML(s){
    return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // ---- å¯¼å‡º ----
  function exportJSON(){
    const store = getStore();
    const ordered = Object.keys(store).sort().reduce((acc,d)=>{acc[d]=store[d]; return acc;},{});
    download(`fishlog-${todayStr()}.json`, JSON.stringify(ordered, null, 2));
  }
  function exportTXT(){
    const store = getStore();
    const dates = Object.keys(store).sort();
    if(!dates.length){ toast('æ²¡æœ‰å¯å¯¼å‡ºçš„è®°å½•'); return; }
    const lines = [];
    dates.forEach(d=>{
      const r = store[d];
      lines.push(
`[${d}]
çŠ¶æ€ï¼š${r.status||''}
è¿›åº¦ï¼š${(r.progress||[]).join(' / ')||'-'}
æˆå°±ï¼š${r.achieve||'-'}
éšè—ï¼š${r.secret||'-'}
ç»“è¯­ï¼š${r.outro||'-'}
----------------------------------------`
      );
    });
    download(`fishlog-${todayStr()}.txt`, lines.join('\n'), 'text/plain;charset=utf-8');
  }

  // ---- ä¸€é”®ç»ˆæ—¥æ— äº‹ ----
  function idleToday(){
    $('#date').value = $('#date').value || todayStr();
    $$('input[name="status"]').forEach(r=>r.checked = (r.value==='ç»ˆæ—¥æ— äº‹'));
    $('#statusCustom').value = '';
    $$(`#progressChecks input`).forEach(i=>i.checked=false);
    $('#achieve').value='';
    $('#secret').value='';
    const rec = readForm();
    rec.outro = "ä»Šå¤©æˆ‘å…è®¸è‡ªå·±æ— äº‹ï¼ŒçŒ«çŒ«ä¼¸ä¸ªæ‡’è…°ï½";
    saveRecord(rec);
    toast('å·²è®°å½•ï¼šç»ˆæ—¥æ— äº‹');
  }

  // ---- äº‹ä»¶ç»‘å®š ----
  function init(){
    $('#date').value = todayStr();

    $('#btnSave').onclick = ()=>{
      const rec = readForm();
      if(!rec.status) { toast('è¯·å…ˆé€‰æ‹©/å¡«å†™ã€Œä»Šæ—¥çŠ¶æ€ã€'); return; }
      saveRecord(rec); toast('å·²ä¿å­˜');
    };
    $('#btnLoad').onclick = ()=> loadRecordByDate($('#date').value || todayStr());
    $('#btnHistory').onclick = ()=>{
      const sec = $('#historySection');
      sec.style.display = (sec.style.display==='none') ? '' : 'none';
      if(sec.style.display!=='none'){ renderHistory(); sec.scrollIntoView({behavior:'smooth'}); }
    };
    $('#btnExportJson').onclick = exportJSON;
    $('#btnExportTxt').onclick = exportTXT;
    $('#btnClearAll').onclick = ()=>{
      const ok = confirm('ç¡®å®šæ¸…ç©ºå…¨éƒ¨è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼');
      if(ok){ localStorage.removeItem(STORAGE_KEY); renderHistory(); toast('å·²æ¸…ç©º'); }
    };
    $('#btnIdle').onclick = idleToday;
    $('#btnAutoOutro').onclick = ()=>{
      const rec = readForm();
      $('#outro').value = autoOutro(rec);
    };
    // åˆ‡åˆ°â€œè‡ªç”±å¡«â€æ—¶èšç„¦è¾“å…¥
    $$('input[name="status"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        if(r.value==='è‡ªç”±å¡«' && r.checked){ $('#statusCustom').focus(); }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>